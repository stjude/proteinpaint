<!DOCTYPE html5>
<html>
<head>
	<meta charset="utf-8">
	<title>St. Jude Genome Paint</title>
	<meta name=keywords content="">
	<meta name=description content="St. Jude Children's Research Hospital - Pediatric Cancer Genomic Data Portal">
	<meta name=viewport content="width=device-width,initial-scale=1">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<script src="/bin/proteinpaint.js" charset="utf-8"></script>
	<noscript>This page requires JavaScript. Please enable it in your browser settings.</noscript>

	<!-- custom CSS style for the page -->
	<style>

		nav, .nav-tabs{
			background-color:#222F3F;
		}

		nav{
			height: 30px;
		}

		nav img{
			margin-top:55px;
			margin-right: 20px;
		}

		h2{
			font-family: Verdana, Geneva, sans-serif;
			color: #E8F1F8;
			margin-top:60px;
		}

		a{
			color:#ADC4D6;
		}

		a:hover{
			color: #E8F1F8;
		}

		.main-tabs{
			margin-left: 20px;
			margin-right: 20px;
		}

		.nav-pills .nav-link.active{
			color: #555555;
			background-color: rgb(204, 204, 204);
		}

		.tab-pane{
			margin: 50px;
		}

		.genome-home{
			margin: 50px 5%;
		}

		.user-data-form{
			width: 50%;
			margin: auto;
		}

		.btn-submit{
			color: #ADC4D6;
			background-color: #222F3F;
			border:0px solid transparent;
		}

		.btn-submit:hover{
			color: #E8F1F8;
			background-color: #222F3F;
			border:0px solid transparent;
		}

		#figures a, #userdata a{
			color: #901739;
		}
	
	/* For laptop */
	@media only screen and (max-width: 1600px) { 
		h2{
			font-size: 28px;
		}
		.nav-link h5{
			margin: 5px;
			font-size: 18px;
		}
		.user-data-form{
			width:70%;
		}
	}

	/* Form tables */
	@media only screen and (max-width: 1300px) { 
		h2{
			font-size: 25px;
			margin-top: 40px;
		}
		nav img{
			margin-top:40px;
		}
		.nav-link h5{
			font-size: 15px;
		}
		.user-data-form{
			width:80%;
		}
	}

	/* for small tablets and phone */
	@media only screen and (max-width:1200px){
		nav{
			height: 60px;
		}
		nav img{
			margin-top:10px;
			margin: auto;
		}
		h2{
			margin-top:10px;
			margin: auto;
			text-align: center;
		}
		.tool-title{
			width: 80%;
			align-items: center;
		}
		.user-data-form{
			width:100%;
		}
	}
	</style>

</head>
<body>

	<!-- header with logo and tool-title -->
	<nav class="navbar navbar-expand-lg">
			<a href="https://www.stjude.org/"><img src="https://pecan.stjude.cloud/assets/images/stjude-logo-child.png" height="40" class="d-inline-block align-top" alt=""></a>
			<div class="tool-title"><h2>GenomePaint</h2></div>
	</nav>

	<!-- tabs for different pages -->
	<div>
		<div style="margin:auto; background-color:#e2e1e1;">
			<ul class="nav nav-tabs justify-content-center" id="myTab" role="tablist">
				<li class="nav-item">
					<a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true"><h5 class="main-tabs">Pediatric Cancer Dataset</h5></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="userdata-tab" data-toggle="tab" href="#userdata" role="tab" aria-controls="userdata" aria-selected="false"><h5 class="main-tabs">Add Your Data</h5></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="figures-tab" data-toggle="tab" href="#figures" role="tab" aria-controls="figures" aria-selected="false"><h5 class="main-tabs">Figures</h5></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="tutorial-tab" data-toggle="tab" href="#tutorial" role="tab" aria-controls="tutorial" aria-selected="false" ><h5 class="main-tabs">Tutorial</h5></a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="help-tab" data-toggle="tab" href="#help" role="tab" aria-controls="help" aria-selected="false" ><h5 class="main-tabs">Help</h5></a>
				</li>
			</ul>
		</div>

		<!-- Content for differnt tabs -->
			<div>
				<div class="tab-content" id="myTabContent" style="align-content: center;">

				<!-- home page -->
				<div class="tab-pane fade show active genome-home" id="home" role="tabpanel" aria-labelledby="home-tab">  
					<div id="PediatricCancer"></div>
				</div>

				<!-- Custom user tracks -->
				<div class="tab-pane fade" id="userdata" role="tabpanel" aria-labelledby="userdata-tab">
					<form class="user-data-form" id="user-track-form">
						<div class="form-group row">
							<label for="genome" class="col-sm-4 col-form-label">Species & Genome</label>
							<div class="col-sm-8">
								<select class="custom-select mr-sm-2" id="genome">
									<option value="hg19">Human hg19</option>
									<option value="hg38" selected>Human hg38</option>
									<option value="mm9">Mouse mm9</option>
									<option value="mm10">Mouse mm10</option>
									<option value="danrer10">Zebrafish danRer10</option>
									<option value="dm3">Fruit fly dm3</option>
									<option value="dm6">Fruit fly dm6</option>
								</select>
							</div>
						</div>
						<div class="form-group row">
							<label for="track-name" class="col-sm-4 col-form-label">Track Name</label>
							<div class="col-sm-8">
								<input type="text" class="form-control" id="track-name" value="DemoTrack">
							</div>
						</div>
						<div class="form-group row">
							<label for="svcnv" class="col-sm-4 col-form-label"><a href="https://docs.google.com/document/d/1owXUQuqw5hBHFERm0Ria7anKtpyoPBaZY_MCiXXf5wE/edit#heading=h.57qr5fp90wn9" target="_blank" data-toggle="tooltip" title="Click for help with file format"> SV, CNV File URL</a></label>
							<div class="col-sm-8">
								<input type="url" class="form-control" id="svcnv" value="https://pecan.stjude.cloud/static/hg38/tcga-gdc/DLBC/TCGA_DLBC.CNV.gz" required>
							</div>
						</div>
						<div class="form-group row">
							<label for="vcf" class="col-sm-4 col-form-label"><a href="https://docs.google.com/document/d/1owXUQuqw5hBHFERm0Ria7anKtpyoPBaZY_MCiXXf5wE/edit#heading=h.hce6nejglfdx" target="_blank" data-toggle="tooltip" title="Click for help with file format"> VCF File URL</a></label>
							<div class="col-sm-8">
								<input type="url" class="form-control" id="vcf" value="https://pecan.stjude.cloud/static/hg38/tcga-gdc/DLBC/TCGA_DLBC.vcf.gz" required>
							</div>
						</div>
						<div><p class="small"><strong>Note:</strong> Either SVCNV file or VCF file is required; you can also submit both.</p></div>
						<div class="form-group row">
							<label for="fpkm" class="col-sm-4 col-form-label"><a href="https://docs.google.com/document/d/1owXUQuqw5hBHFERm0Ria7anKtpyoPBaZY_MCiXXf5wE/edit#heading=h.v8yrfg1dqvdy" target="_blank" data-toggle="tooltip" title="Click for help with file format">FPKM File URL (optional)</a></label>
							<div class="col-sm-8">
								<input type="url" class="form-control" id="fpkm" value="https://pecan.stjude.cloud/static/hg38/tcga-gdc/DLBC/TCGA_DLBC.fpkm.gz">
							</div>
						</div>
						<div style="text-align:center">
							<button id="clear-btn" type="submit" class="btn btn-primary btn-submit" style="width: 150px; margin: 0 auto;">Clear Form</button>
							<button id="usedata-btn" type="submit" class="btn btn-primary btn-submit" style="width: 150px; margin: 0 auto;">Submit</button>
						</div>
					</form>
					<div id="user-custom-track" class="tab-pane" style="display:none;"></div>
					<div id="code-snippet">
						<h6 style="text-align:center;"> Add following Javascript code to your webpage to display this track </h6>
						<pre id="snippet" class="border border-secondary" style="padding:20px;"></pre>
					</div>
					<div id="url-div">
							<h6 style="text-align:center; margin-top:20px;"> URL for this track</h6>
							<a href="" id="custom-track-link" target="_blank">Oepn in new tab</a>
					</div>	
					<button id="show-snippet" type="submit" class="btn btn-primary btn-submit" style="width: 250px; margin: 10px auto; display :none;">Show Embedding JS Code</button>
					<button id="show-custom-url" type="submit" class="btn btn-primary btn-submit" style="width: 250px; margin: 10px auto; display :none;">Custom Track URL</button>
					<button id="return-button" type="submit" class="btn btn-primary btn-submit" style="width: 250px; margin: 10px auto; display :none;">Return to the Form</button>
					<div style="margin:40px; text-align:center;">
						<h5 class="margin-bottom:40px;">More on custom track</h5>
						<h6 style="margin-top:40px"><a href="https://docs.google.com/document/d/1owXUQuqw5hBHFERm0Ria7anKtpyoPBaZY_MCiXXf5wE/edit#heading=h.62y4gp2dq4ud" target="_blank">Host and launch custom GenomePaint track from DNAnexus</a></h6>
						<h6 style="margin-top:20px"><a href="https://docs.google.com/document/d/1TC6pcAByqugzMWQ0C7mhHIHIkIxkqqDt1ATBBt_ehes/edit" target="_blank">Tutorial on downloading data from NCI Genomic Data Commons and converting to custom tracks</a></h6>
					</div>
				</div>

				<!-- Figures -->
				<div class="tab-pane fade" id="figures" role="tabpanel" aria-labelledby="figures-tab">
					<div class="col-md-10 offset-md-1">
						<ul class="list-group">
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/tall.tal1.html" target="_blank"><strong>Figure 2:</strong> Illustrating multiple mechanisms for oncogene TAL1 activation in Cohort View.</a>
							</li>
							<li class="list-group-item"><a href=" https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/matrix.nbl.KM.html" target="_blank"><strong>Figure 3:</strong> Matrix View reviews mutual-exclusive or co-mutation pattern, for association with patient outcome.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/sampleview.html" target="_blank"><strong>Figure 4:</strong> Visualize multi-omics data with dynamic range in Sample View.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/myc.sv.nb69.html" target="_blank"><strong>Figure 5:</strong> Sample View of interchromsomal rearrangement leading to MYC dysregulation by enhancer-hijacking.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/crebbp.splicesite.html" target="_blank"><strong>Figure 6:</strong> Assessing aberrant splicing in CREBBP caused by somatic splice site variants.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/myc.enhancer.nalm6.html" target="_blank"><strong>Figure 7:</strong> MYC dysregulation by enhancer duplications in pediatric cancers.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/ikzf1.tp53.html" target="_blank"><strong>Supplementary figure 1: </strong> Cohort View shows different mutation mechanisms causing loss-of-function in tumor suppressors.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/tall.myb.mdm2.html" target="_blank"><strong>Supplementary figure 2:</strong> Cohort View enables associating mutation or expression data with patient outcomes.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/crebbp.deletion.html" target="_blank"><strong>Supplementary figure 3:</strong> B-ALL shows diverse alterations targeting CREBBP RING domain.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/myc.enhancer.newcases.html" target="_blank"><strong>Supplementary figure 4:</strong> Previously unreported cases of likely MYC enhancer duplication/amplification in pediatric tumors and cell line.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/myc.enhancer.nalm6.nalm16.html" target="_blank"><strong>Supplementary figure 5:</strong> In-situ Hi-C shows MYC interaction with duplicated enhancers in NALM6 and NALM16.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/myc.enhancer.nalm6.phased.html" target="_blank"><strong>Supplementary figure 6:</strong> Phased sequencing coverage in NALM6.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/myc.nalm6.notch1.html" target="_blank"><strong>Supplementary figure 7:</strong> DUX4 but not NOTCH1 likely binds at N-ME in NALM6.</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/tcga.dlbc.html" target="_blank"><strong>Supplementary figure 8:</strong> CDKN2A/2B focal deletion and sequence mutations from adult diffuse large B-cell lymphoma (DLBC)</a>
							</li>
							<li class="list-group-item"><a href="https://proteinpaint.stjude.org/F/hg19/pediatric.mds.example/tcga.skcm.html" target="_blank"><strong>Supplementary figure 9:</strong> TERT sequence mutations in adult cutaneous melanoma (SKCM).</a>
							</li>
						</ul>
					</div>
				</div>

				<!-- Tutorial page -->
				<div class="tab-pane fade" id="tutorial" role="tabpanel" aria-labelledby="tutorial-tab">
					<div>
						<h5 style="text-align:center;">GenomePaint User Tutorial</h5>
						<div class="col-md-8 offset-md-2">
							<a class="btn btn-submit col-md-4 offset-md-4" style="margin-top: 20px; margin-bottom: 20px;" href="https://docs.google.com/document/d/1owXUQuqw5hBHFERm0Ria7anKtpyoPBaZY_MCiXXf5wE/edit?usp=sharing" target="_blank">Open in Google Doc</a>
							<iframe src="https://docs.google.com/document/d/e/2PACX-1vShn3jGO7Q5AFUkRyjw8rksGkv1sOPKxOectzgiJvkRD4Dj2tsO7VtelNcVN9wbxK6TGudiDUf4Mn-5/pub?embedded=true" width="100%" height="800px"></iframe>
						</div>
					</div>
				</div>
				
				<!-- Help page -->
				<div class="tab-pane fade" id="help" role="tabpanel" aria-labelledby="help-tab">
					<div>
						<h5 style="text-align:center;">Google Group</h5>
						<div class="col-md-8 offset-md-2">
								<a class="btn btn-submit col-md-4 offset-md-4" style="margin-top: 20px; margin-bottom: 20px;" href="https://groups.google.com/forum/#!forum/genomepaint" target="_blank">Ask us at Google Group</a>
						</div>
					</div>
				</div>

				</div>
			</div>
		</div>

		<!-- Custom Javascript -->
		<script>

			// ---- Home page code ---- //
			runproteinpaint({
				host:'https://proteinpaint.stjude.org',
				holder:document.getElementById('PediatricCancer'),
				parseurl:true,
				block:true,
				nobox:1,
				noheader:1,
				genome:'hg19',
				position:'chr1:47661752-47798811',
				nativetracks:'RefGene',
				datasetqueries:[{dataset:'Pediatric2',querykey:'svcnv'}]
			})

			// Helper function for url check
			function ValidURL(str) {
				var pattern = new RegExp("((http|https)(:\/\/))?([a-zA-Z0-9]+[.]{1}){2}[a-zA-z0-9]+(\/{1}[a-zA-Z0-9]+)*\/?", "i"); 
				if(!pattern.test(str)) {
					alert("Please enter a valid URL.");
					return false
				} else {
					return true
				}
			}

			// ----- Custom user track page ------ //
			$("#code-snippet").hide()
			$("#url-div").hide()

			// Function when custom track form submitted
			document.getElementById("usedata-btn").addEventListener("click", function(event){
				event.preventDefault();
				const genome_list = document.getElementById("genome")
				const genome_select = genome_list.options[genome_list.selectedIndex].value
				const trackName = document.getElementById("track-name").value || 'Custom track'
				const svcnv_url = document.getElementById("svcnv").value
				const vcf_url = document.getElementById("vcf").value
				const fpkm_url = document.getElementById("fpkm").value
				const form = document.getElementById("user-track-form")
				const return_btn = document.getElementById("return-button")
				const snippet_btn = document.getElementById("show-snippet")
				const url_btn = document.getElementById("show-custom-url")
				const genome_view = document.getElementById('user-custom-track')
				const code_snippet = document.getElementById('code-snippet')
				// console.log(genome_select, trackName, svcnv_url, vcf_url, fpkm_url)
				genome_view.style.display = "block"
				
				if (svcnv_url == "" && vcf_url == ""){
					alert("Either SVCNV or VCF track is required.")
					return false;
				}

				var custom_track_url = 'https://proteinpaint.stjude.org?block=on&genome=' + genome_select
										+ '&svcnvfpkmurl=' + trackName

				const tk = {
					name:trackName,
					type:'mdssvcnv',
				}


				// test what file is given
				if( svcnv_url ) {
					tk.url = svcnv_url
					custom_track_url += ',svcnv,'
					custom_track_url += svcnv_url
				}

				if( vcf_url ) {
					tk.checkvcf = { url:vcf_url }
					custom_track_url += ',vcf,' + vcf_url

				}

				if( fpkm_url ) {
					tk.checkexpressionrank = { url:fpkm_url }
					custom_track_url += ',fpkm,' + fpkm_url

				}

				runproteinpaint({
					holder:document.getElementById('user-custom-track'),
					host:'https://proteinpaint.stjude.org',
					genome: genome_select,
					block:1,
					nobox:1,
					noheader:1,
					nativetracks:'refgene',
					tracks: [ tk ]
				})

				// to show embedding code
					const runpp_arg = {
						host:'https://proteinpaint.stjude.org',
						genome: genome_select,
						block:1,
						nobox:1,
						noheader:1,
						nativetracks:'refgene',
						tracks: [ tk ]
					}
				
				$("#snippet").text('runproteinpaint(' + JSON.stringify(runpp_arg, null, 2) + ')' )
				
				// custom URL track
				const a = document.getElementById('custom-track-link')
				a.href = custom_track_url
				a.text = custom_track_url

				form.style.display = "none"
				return_btn.style.display = "block"
				snippet_btn.style.display = "block"
				url_btn.style.display = "block"

			});

			// Fucntion for clearing form data
			document.getElementById("clear-btn").addEventListener("click", function(event){
				event.preventDefault();
				document.getElementById("track-name").value = ""
				document.getElementById("svcnv").value = ""
				document.getElementById("vcf").value = ""
				document.getElementById("fpkm").value = ""
			});

			// Function for shwoing code snippet
			document.getElementById("show-snippet").addEventListener("click", function(event){
				event.preventDefault()
				$("#code-snippet").show()
				this.style.display = "none"
			});

			// Function for showing custom track URL
			document.getElementById("show-custom-url").addEventListener("click", function(event){
				event.preventDefault()
				$("#url-div").show()
				this.style.display = "none"
			});

			//function when clicking return to custom track Form
			document.getElementById("return-button").addEventListener("click", function(event){
				event.preventDefault()
				const form = document.getElementById("user-track-form")
				const return_btn = document.getElementById("return-button")
				const genome_view = document.getElementById('user-custom-track')
				const code_snippet = document.getElementById('code-snippet')
				const snippet_btn = document.getElementById("show-snippet");
				const url_btn = document.getElementById("show-custom-url");

				form.style.display = "block"
				genome_view.innerHTML = ""
				this.style.display = "none"
				snippet_btn.style.display = "none"
				url_btn.style.display = "none"
				$("#code-snippet").hide()
				$("#url-div").hide()
			});

		</script>
</body>
</html>
